#!/bin/bash
########################################################
#       Name: malware.sh                               #
#       Description: Grab Emotet IOC from URLHaus      #
########################################################
#Variables
url="https://urlhaus.abuse.ch/downloads/csv"
bulk="bulk.txt"
day=$(date +%Y-%m-%d)

#Remove previuos days files
if ls /home/cmaulding/Desktop/Emotet/scripts/*.txt 1> /dev/null 2>&1;
then
        rm *.txt
fi

#Get the new days malware CSV files
curl --insecure -o $bulk $url

#parse file for only the day of  malware
cat bulk.txt | grep $day >  malware.txt

#Parse for only URL and remove the starting and trailing "
cat malware.txt | cut -d"," -f3 | sed -e 's/^"//' -e 's/"$//' > urls.txt




#This half of the script isnt always nessesary but can be used when sending from a hosted enviroment.#
#Change the HTTP to HXXP to avoid spam filters
#cat urls.txt | sed -e 's/http/hxxp/' > sanitized.txt

#Get only the FQDN for the TLD
#cat urls.txt | cut -d"/" -f3 > fqdn.txt

#mailil the IOC list to email address wanted
#echo "" | mail -s "Emotet IOCs ($day)" -A sanitized.txt email address
